<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="../img/logo.png" type="image/x-icon" />
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/nav.css" />
    <link rel="stylesheet" href="../css/mobile.css" />
    <link rel="stylesheet" href="../css/subnav.css" />
    <link rel="stylesheet" href="css/style.css" />
    <title>E.Carrechan</title>
  </head>

  <body>
    <header>
      <div class="logo-container">
        <a href="../index.html" class="logo-container">
          <img src="../img/logo.png" alt="Logo" class="logo" />
          <h1 id="company-name">
            <span class="r">E</span>
            <span class="v">.</span>
            <span class="b">Carre</span>
            <span class="v">chan</span>
          </h1>
        </a>
      </div>

      <nav>
        <ul class="nav">
          <li class="infobulle">
            <a href="../algorithmes/index.html" class="active">Algorithmes</a>
          </li>
          <li class="infobulle">
            <a href="../fonctionnalites/index.html">Fonctionnalités</a>
          </li>
          <li class="infobulle">
            <a href="../difficultes/index.html">Difficultés</a>
          </li>
          <li class="infobulle">
            <a href="../conclusion/index.html">Conclusion</a>
          </li>
          <li class="infobulle">
            <a href="../mission/index.html">Missions</a>
          </li>
        </ul>
      </nav>

      <input type="checkbox" id="nav-toggle" aria-hidden="true" />
      <label for="nav-toggle" class="hamburger" aria-label="Ouvrir le menu">
        <span></span>
      </label>
    </header>

    <main>
      <div class="description">
        <h2>Comptabilité journalière</h2>
      </div>

      <div class="subnav-contour">
        <nav class="sub-nav">
          <ul>
            <li><a href="index.html">⬅</a></li>
            <li><a href="LectureCSV.html">Lecture CSV</a></li>
            <li><a href="GestionStock.html">Gestion Stock</a></li>
            <li><a href="GestionPersonnel.html">Gestion Personnel</a></li>
            <li><a href="ServiceClient.html">Service Client</a></li>
            <li><a href="Comptabilite.html" class="active">Comptabilité</a></li>
          </ul>
        </nav>
      </div>

      <section class="code">
        <h3>Fonctionnement</h3>
        <pre>
          <code>
double compta_journalier(char entetes[NB_COLONNES][TAILLE_CHAMP],
            char produits[MAX_LIGNES][TAILLE_CHAMP],
            float quantites[MAX_LIGNES],
            float prixUnitaires[MAX_LIGNES],
            double client_id[MAX_LIGNES]
            )
{

    double clientsTraites[MAX_LIGNES];  // Liste des clients déjà traités
    int nbClients = 0;
    float total_final = 0;
    char a = ' ';
    printf("--------------------------------------------------------------------------------------------------------------------------------\n");
        printf("%-62s| %-21s| %-21s| %-21s|\n", "Produit", "Qte", "Pu(€)", "Total(€)");
        printf("--------------------------------------------------------------------------------------------------------------------------------\n");
    for (int i = 0; i < MAX_LIGNES; i++) {
        // Ligne vide → on passe
        if (strlen(produits[i]) == 0)
            continue;

        double idCourant = client_id[i];
        if (idCourant == 0)  // client_id non défini
            continue;

        // Vérifie si ce client a déjà été traité
        int dejaFait = 0;
        for (int j = 0; j < nbClients; j++) {
            if (clientsTraites[j] == idCourant) {
                dejaFait = 1;
                break;
            }
        }
        if (dejaFait)
            continue;

        // Sinon, on l’ajoute à la liste
        clientsTraites[nbClients++] = idCourant;

        

        float total = 0.0f;


        // Parcourir toutes les lignes pour les produits de ce client
        for (int k = 0; k < MAX_LIGNES; k++) {
            if (strlen(produits[k]) == 0)
                continue;

            if (client_id[k] == idCourant) {
                float sousTotal = quantites[k] * prixUnitaires[k];
                total += sousTotal;
                printf("%-62s| %-21.2f| %-21.2f| %-17.2f|\n",
                       produits[k], quantites[k], prixUnitaires[k], sousTotal);
            }
        }
        
        total_final += total;
    }
    printf("--------------------------------------------------------------------------------------------------------------------------------\n");
    printf("Total: %-.2f € %109c|\n", total_final, a);
    printf("--------------------------------------------------------------------------------------------------------------------------------\n");

    return 0;
}            
          </code>
        </pre>
        <p>
          La fonction compta_journalier affiche la liste des produits vendus
          pour chaque client et calcule les totaux.
        </p>
        <ol>
          <li>
            <strong>Initialisation:</strong> Elle prépare une liste
            clientsTraites pour ne compter chaque client qu'une seule fois. Elle
            met aussi un total général total_final à 0.
          </li>
          <li>
            <strong>Parcours des lignes de données:</strong> Pour chaque ligne :
            Si le produit est vide → on ignore. Si l’ID du client est 0 → on
            ignore. On vérifie si le client a déjà été traité. Si oui → on passe
            au suivant. Sinon → on ajoute le client à la liste des clients déjà
            traités.
          </li>
          <li>
            <strong>Traitement d’un client:</strong> Une fois un nouveau client
            détecté : On parcourt toutes les lignes pour trouver toutes ses
            commandes. Pour chaque produit appartenant à ce client : On calcule
            quantité × prix unitaire. On affiche la ligne du produit. On ajoute
            ce sous-total au total du client.
          </li>
          <li>
            <strong>Total général:</strong> Le total du client est ajouté à
            total_final.
          </li>
          <li>
            <strong>Affichage final:</strong> Une ligne affiche le total général
            de toutes les ventes.
          </li>
        </ol>
      </section>
    </main>
  </body>
</html>
